<!DOCTYPE html>
<html lang="en">
<meta name="apple-mobile-web-app-title" content="Finance Tracker">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="logo.png">
<link rel="icon" type="image/png" href="logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MY FIRST PROJECT</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #EFEBE3; --card: #F7F4F0; --forest: #5B7A47; --dark-forest: #2D3E2E; --text: #1C1917; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: env(safe-area-inset-top) 16px 200px 16px; touch-action: manipulation; }
        .pro-card { background: var(--card); border-radius: 40px; border: 1px solid rgba(0,0,0,0.03); box-shadow: 0 4px 12px rgba(0,0,0,0.02); }
        .nav-active { background-color: var(--forest) !important; color: white !important; }
        .stock-box { width: 44px; height: 44px; border-radius: 14px; border: 2px solid #E7E5E4; display: flex; align-items: center; justify-content: center; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .stock-box.checked { background-color: var(--forest); border-color: var(--forest); color: white; }
        input { font-size: 24px !important; border-radius: 20px; background: rgba(0,0,0,0.05); padding: 12px; text-align: right; outline: none; width: 140px; font-weight: 800; color: var(--dark-forest); border: 2px solid transparent; }
        input:focus { background: white; border: 2px solid var(--forest); }
    </style>
</head>
<body class="max-w-md mx-auto">

    <header class="pt-8 mb-6">
        <div class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-4xl font-black tracking-tighter text-[#2D3E2E]">Ledger.</h1>
                <div class="flex items-center mt-2">
                    <span class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse mr-2"></span>
                    <p id="countdown" class="text-xs font-bold text-stone-500 uppercase tracking-widest"></p>
                </div>
            </div>
            <div class="text-right">
                <span id="top-label" class="bg-[#FDE68A] text-[#92400E] px-4 py-1.5 rounded-full text-[10px] font-black uppercase">Goal</span>
                <p id="top-amount" class="text-3xl font-black text-[#92400E] mt-1">610,000 KHR</p>
            </div>
        </div>

        <nav class="bg-[#E7E5E4]/50 p-2 flex gap-1 rounded-[30px]">
            <button onclick="switchPage('main')" id="btn-main" class="flex-1 py-4 rounded-[24px] text-sm font-bold text-stone-600 transition-all">Main</button>
            <button onclick="switchPage('moto')" id="btn-moto" class="flex-1 py-4 rounded-[24px] text-sm font-bold text-stone-600 transition-all">Moto</button>
            <button onclick="switchPage('snack')" id="btn-snack" class="flex-1 py-4 rounded-[24px] text-sm font-bold text-stone-600 transition-all">Snack</button>
        </nav>
    </header>

    <main id="app-container" class="space-y-4"></main>

    <footer class="fixed bottom-6 left-4 right-4 max-w-md mx-auto z-50">
        <div class="bg-[#2D3E2E] text-white p-8 rounded-[45px] shadow-2xl border-t border-white/10">
            <div class="flex justify-between items-end">
                <div>
                    <p id="footer-label" class="text-[10px] font-black text-stone-400 uppercase tracking-widest mb-1"></p>
                    <p id="footer-amount" class="text-4xl font-black tracking-tighter leading-none">-- KHR</p>
                </div>
                <div class="text-right">
                    <p id="payday-date" class="text-sm font-black mb-1"></p>
                    <p id="sync-status" class="text-[9px] text-stone-400 uppercase font-bold tracking-widest">Connecting...</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // --- 1. FIREBASE CONFIGURATION (Updated from your screenshots) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCBhtDe3ovmoC70IVS0zPXVgTbg5OX3_9k",
            authDomain: "gentle-impulse-454415-d7.firebaseapp.com",
            projectId: "gentle-impulse-454415-d7",
            storageBucket: "gentle-impulse-454415-d7.firebasestorage.app",
            messagingSenderId: "816479667222",
            appId: "1:816479667222:web:8b7eb363fc7301912f2137",
            // Corrected Singapore Region URL
            databaseURL: "https://gentle-impulse-454415-d7-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        const CONFIG = {
            main: { budget: 610000, items: [
                {id:'item1', label:'Formular', target:8, price:60000},
                {id:'item2', label:'Diaper', target:6, price:12000},
                {id:'item3', label:'Water', target:19, price:3000}
            ]},
            moto: { budget: 150000 },
            snack: { budget: 240000 }
        };

        // --- 2. STATE & DATABASE ---
        let state = { 
            page: 'main', 
            dbData: JSON.parse(localStorage.getItem('my_project_ledger')) || {} 
        };

        let db = null;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            document.getElementById('sync-status').innerText = "Live Global Sync";

            // Sync from Cloud
            db.ref('project_shared_data').on('value', (snap) => {
                if (snap.exists()) {
                    state.dbData = snap.val();
                    localStorage.setItem('my_project_ledger', JSON.stringify(state.dbData));
                    render();
                }
            });
        } catch (e) {
            console.error(e);
            document.getElementById('sync-status').innerText = "Local Mode";
        }

        function getCycle() {
            const now = new Date();
            let year = now.getFullYear();
            let month = now.getMonth();
            if (now.getDate() < 11) month -= 1; 
            const start = new Date(year, month, 11);
            const end = new Date(year, month + 1, 10);
            const id = `${start.getFullYear()}-${(start.getMonth() + 1).toString().padStart(2, '0')}`;
            return { start, end, id };
        }

        // --- 3. UI RENDERING ---
        function switchPage(p) { state.page = p; render(); }

        function render() {
            const cycle = getCycle();
            const cycleData = state.dbData[cycle.id] || { stock: {}, logs: {} };
            const container = document.getElementById('app-container');
            
            const daysLeft = Math.ceil((cycle.end - new Date()) / (1000*60*60*24));
            document.getElementById('countdown').innerText = `${daysLeft} DAYS LEFT`;
            document.getElementById('payday-date').innerText = `End Date: ${cycle.end.toLocaleDateString('en-US', {month:'short', day:'numeric'})}`;

            document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active'));
            document.getElementById(`btn-${state.page}`).classList.add('nav-active');

            if (state.page === 'main') {
                let spent = 0;
                CONFIG.main.items.forEach(item => spent += (cycleData.stock?.[item.id] || 0) * item.price);
                document.getElementById('top-amount').innerText = `610,000 KHR`;
                document.getElementById('footer-label').innerText = "MAIN BUDGET LEFT";
                document.getElementById('footer-amount').innerText = `${(CONFIG.main.budget - spent).toLocaleString()} KHR`;
                
                container.innerHTML = CONFIG.main.items.map(item => {
                    const count = cycleData.stock?.[item.id] || 0;
                    let boxes = '';
                    for(let i=1; i<=item.target; i++) {
                        boxes += `<div onclick="upStock('${cycle.id}','${item.id}',${i})" class="stock-box ${count >= i ? 'checked' : 'text-stone-300'}">âœ“</div>`;
                    }
                    return `<div class="pro-card p-8"><div class="flex justify-between items-center mb-6"><div><h3 class="font-black text-xl text-[#2D3E2E]">${item.label}</h3><p class="text-[10px] text-stone-400 font-black mt-1 uppercase tracking-widest">${item.price.toLocaleString()} KHR</p></div><p class="text-[#92400E] font-extrabold">-${((item.target - count) * item.price).toLocaleString()} KHR</p></div><div class="flex flex-wrap gap-3">${boxes}</div></div>`;
                }).join('');
            } else {
                let spentTotal = 0;
                Object.values(cycleData.logs || {}).forEach(d => spentTotal += (d[state.page] || 0));
                document.getElementById('top-amount').innerText = `${CONFIG[state.page].budget.toLocaleString()} KHR`;
                document.getElementById('footer-label').innerText = `${state.page.toUpperCase()} BUDGET LEFT`;
                document.getElementById('footer-amount').innerText = `${(CONFIG[state.page].budget - spentTotal).toLocaleString()} KHR`;
                
                let html = ``, curr = new Date(cycle.start);
                while(curr <= cycle.end) {
                    const dKey = curr.toISOString().split('T')[0];
                    const val = cycleData.logs?.[dKey]?.[state.page] || 0;
                    html += `<div class="pro-card p-6 flex justify-between items-center ${curr < new Date().setHours(0,0,0,0) ? 'opacity-30' : ''}"><div><p class="text-xs font-black text-stone-400 uppercase tracking-widest mb-1">DAILY LOG</p><h3 class="font-black text-lg text-[#2D3E2E]">${curr.toLocaleDateString('en-US',{weekday:'short', month:'short', day:'numeric'})}</h3></div><input type="number" value="${val || ''}" placeholder="0" onchange="upLog('${cycle.id}','${dKey}',this.value)"></div>`;
                    curr.setDate(curr.getDate()+1);
                }
                container.innerHTML = html;
            }
        }

        // --- 4. DATA UPDATES ---
        function pushUpdate() {
            localStorage.setItem('my_project_ledger', JSON.stringify(state.dbData));
            if (db) db.ref('project_shared_data').set(state.dbData);
            render();
        }

        window.upStock = (cid, id, v) => {
            if(!state.dbData[cid]) state.dbData[cid] = {stock:{}, logs:{}};
            if(!state.dbData[cid].stock) state.dbData[cid].stock = {};
            state.dbData[cid].stock[id] = (state.dbData[cid].stock[id] === v) ? v - 1 : v;
            pushUpdate();
        };

        window.upLog = (cid, dk, v) => {
            if(!state.dbData[cid]) state.dbData[cid] = {stock:{}, logs:{}};
            if(!state.dbData[cid].logs) state.dbData[cid].logs = {};
            if(!state.dbData[cid].logs[dk]) state.dbData[cid].logs[dk] = {};
            state.dbData[cid].logs[dk][state.page] = parseInt(v) || 0;
            pushUpdate();
        };

        render();
    </script>
</body>

</html>
<link rel="apple-touch-icon" href="clover.jpg">
<link rel="icon" type="image/jpeg" href="clover.jpg">
